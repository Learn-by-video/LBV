<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>L.B.V. - Main Page</title>

    <meta name="description" content="L.B.V. - Learn by Video. Explore facts, videos, and games in an interactive educational platform." />
    <meta name="keywords" content="L.B.V, Learn by Video, educational platform, facts, videos, games, learning" />
    <meta name="author" content="L.B.V. Team" />

    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/Learn-by-video/assets/refs/heads/main/Favcon/l-b-v.jpg">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Learn-by-video/assets/refs/heads/main/Favcon/l-b-v.jpg">
    <meta name="theme-color" content="#003366">

    <meta property="og:title" content="L.B.V. - Learn by Video" />
    <meta property="og:description" content="Explore facts, videos, and games in an engaging educational platform." />
    <meta property="og:image" content="https://lbv.giize.com/l-b-v.jpg" />
    <meta property="og:url" content="https://lbv.giize.com" />
    <meta name="twitter:card" content="summary_large_image">

    <style>
        html, body {
            overflow-x: hidden;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #003366;
            color: white;
            text-align: center;
            height: 100%;
        }
        header, footer {
            background: #003366;
            padding: 20px;
        }
        header a {
            text-decoration: none;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        header a:hover {
            text-decoration: underline;
        }
        .nav-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
        }
        .nav-links a {
            background: white;
            color: #003366;
            padding: 15px 25px;
            font-size: 18px;
            font-weight: bold;
            text-decoration: none;
            border-radius: 5px;
        }
        .nav-links a:hover {
            background: #ddd;
        }
        #tools-section {
            display: none;
            margin-top: 20px;
        }
        #tools-button {
            background: white;
            color: #003366;
            padding: 15px 25px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #tools-button:hover {
            background: #ddd;
        }
        .version-banner {
            position: fixed;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 1em;
            opacity: 0.7;
        }

        /* Modal (popup) styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.65);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
        }
        .modal {
            background: #111;
            color: #fff;
            border-radius: 12px;
            padding: 24px;
            max-width: 640px;
            width: 100%;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            text-align: left;
        }
        .modal h2 {
            margin: 0 0 8px 0;
            font-size: 20px;
            text-align: center;
        }
        .modal p {
            margin: 0 0 12px 0;
            color: #ddd;
            font-size: 14px;
            text-align: center;
        }
        .modal label { display:block; margin: 8px 0 6px 0; color:#ccc; font-size:13px; }
        .modal textarea {
            width: 100%;
            min-height: 140px;
            resize: vertical;
            padding: 10px;
            border-radius: 8px;
            border: none;
            outline: none;
            font-size: 14px;
            background: #0b0b0b;
            color: #eaeaea;
        }
        .controls-row {
            display:flex;
            gap:10px;
            margin-top:12px;
            flex-wrap:wrap;
            align-items:center;
        }
        .modal input[type="number"], .modal input[type="text"], .modal select {
            padding:10px;
            border-radius:8px;
            border:none;
            outline:none;
            background:#0b0b0b;
            color:#eaeaea;
            font-size:14px;
        }
        .btn {
            background: #00f2ea;
            color: #000;
            padding: 10px 16px;
            font-size: 14px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 12px rgba(0,255,255,0.3);
        }
        .btn:hover {
            box-shadow: 0 0 22px rgba(0,255,255,0.6);
            transform: translateY(-1px);
        }
        .btn.secondary {
            background: #333;
            color: #fff;
            box-shadow: none;
            border: 1px solid #444;
        }
        .small {
            font-size: 12px;
            color: #aaa;
        }

        @media (max-width: 560px) {
            .modal { padding: 14px; }
            .modal textarea { min-height: 110px; }
            .controls-row { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>

<header>
    <a href="index.html">L.B.V. - Learn by Video</a>
    <p>Explore Facts, Videos, and Games!</p>
</header>

<div class="nav-links">
    <a href="/lbv/facts/">Facts</a>
    <a href="/lbv/videos/">Videos</a>
    <a href="/lbv/games/">Games</a>
</div>

<div id="tools-section">
    <h2>ðŸ”§ Tools ðŸ”§</h2>
    <p>Secret tools unlocked!</p>
    <button id="tools-button" onclick="window.location.href='/lbv/tools_5342/'">Access Tools</button>
</div>

<footer>
    <p>Â© 2025 L.B.V. - Learn by Video. All rights reserved.</p>
</footer>

<div class="version-banner">
    Site Version: <span id="siteVersion">Loading...</span>
</div>

<!-- History Flood Modal (enhanced) -->
<div id="historyModalOverlay" class="modal-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document">
        <h2>History Flood Tool â€” Randomized Sites</h2>
        <p>Provide a list of site identifiers (one per line). The tool will push fake history entries using these items randomly. By default it will go through the list once (no repeats within that run). Use "Cycles" to repeat the whole randomized set multiple times.</p>

        <label for="sitesList">Sites (one per line). These are used to build unique history paths â€” they don't navigate away from this page:</label>
        <textarea id="sitesList" placeholder="example.com
example.org/page
youtube.com/watch?v=abc"></textarea>

        <div class="controls-row" style="margin-top:10px;">
            <div style="display:flex;gap:8px;align-items:center;">
                <label class="small" for="cycles">Cycles</label>
                <input id="cycles" type="number" min="1" value="1" style="width:80px" />
            </div>

            <div style="display:flex;gap:8px;align-items:center;">
                <label class="small" for="capPerCycle">Max pushes per cycle (optional)</label>
                <input id="capPerCycle" type="number" min="1" placeholder="leave blank = all" style="width:110px" />
            </div>

            <div style="display:flex;gap:8px;align-items:center;">
                <label class="small" for="useFullPath">Use as path or hash?</label>
                <select id="useFullPath">
                    <option value="path">/flood/[site]</option>
                    <option value="hash">#/flood/[site]</option>
                </select>
            </div>
        </div>

        <div class="controls-row" style="margin-top:14px;">
            <button class="btn" id="startFloodBtn">Start Flood</button>
            <button class="btn secondary" id="closeModalBtn">Cancel</button>
        </div>

        <p class="small" style="margin-top:12px; text-align:center;">
            Shortcut to open: Ctrl + Alt + Shift + Z
        </p>
    </div>
</div>

<script>
    // Konami code logic (kept)
    (function() {
        const konamiCode = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
        let inputKeys = [];
        document.addEventListener("keydown", function(event) {
            inputKeys.push(event.keyCode);
            if (inputKeys.toString().indexOf(konamiCode.toString()) > -1) {
                document.getElementById("tools-section").style.display = "block";
                inputKeys = [];
            }
        });
    })();

    // Load version text
    async function fetchVersion() {
        try {
            const response = await fetch("/version.txt?nocache=" + new Date().getTime());
            const versionText = await response.text();
            document.getElementById("siteVersion").textContent = versionText.trim();
        } catch (error) {
            document.getElementById("siteVersion").textContent = "Unavailable";
        }
    }
    window.onload = fetchVersion;

    // History modal controls and randomized no-repeat shuffle logic
    (function() {
        const overlay = document.getElementById('historyModalOverlay');
        const sitesTextarea = document.getElementById('sitesList');
        const cyclesInput = document.getElementById('cycles');
        const capPerCycleInput = document.getElementById('capPerCycle');
        const useFullPathSelect = document.getElementById('useFullPath');
        const startBtn = document.getElementById('startFloodBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');

        function openHistoryModal() {
            overlay.style.display = 'flex';
            overlay.setAttribute('aria-hidden', 'false');
            sitesTextarea.focus();
        }
        function closeHistoryModal() {
            overlay.style.display = 'none';
            overlay.setAttribute('aria-hidden', 'true');
        }

        // Fisher-Yates shuffle
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function buildPathFor(site, cycleIndex, itemIndex, useHash) {
            // Create a reasonably safe path fragment using encodeURIComponent
            const safe = encodeURIComponent(site).replace(/%20/g, '+');
            if (useHash) {
                return '#/flood/' + safe + '/' + cycleIndex + '-' + itemIndex;
            } else {
                return '/flood/' + safe + '/' + cycleIndex + '-' + itemIndex;
            }
        }

        function validateAndParseSites(text) {
            const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
            // deduplicate identical lines while preserving order
            const seen = new Set();
            const unique = [];
            for (const l of lines) {
                if (!seen.has(l)) {
                    seen.add(l);
                    unique.push(l);
                }
            }
            return unique;
        }

        function pushHistoryEntriesForList(sites, cycles, capPerCycle, useHash) {
            // total pushes calculation
            const perCycle = capPerCycle && capPerCycle > 0 ? Math.min(capPerCycle, sites.length) : sites.length;
            const total = perCycle * cycles;
            const SAFETY_CAP = 5000;
            if (total > SAFETY_CAP) {
                if (!confirm("You are about to push " + total + " history entries. This may affect browser performance. Continue?")) {
                    return false;
                }
            }

            let pushCount = 0;
            for (let c = 1; c <= cycles; c++) {
                // shuffle a copy for this cycle to ensure no repeats within a cycle
                const shuffled = shuffleArray(sites.slice());
                const limit = capPerCycle && capPerCycle > 0 ? Math.min(capPerCycle, shuffled.length) : shuffled.length;

                for (let i = 0; i < limit; i++) {
                    const site = shuffled[i];
                    const path = buildPathFor(site, c, i+1, useHash);
                    try {
                        // When using hash, modify location.hash; otherwise pushState
                        if (useHash) {
                            // Use replace first to avoid interfering with future pages, then push small state
                            location.hash = path;
                            history.pushState({}, '', path);
                        } else {
                            history.pushState({}, '', path);
                        }
                    } catch (e) {
                        console.error("push failed on iteration", c, i, e);
                        // stop if pushState is failing repeatedly
                        return false;
                    }
                    pushCount++;
                }
            }

            alert("History flood complete: " + pushCount + " entries pushed.");
            return true;
        }

        startBtn.addEventListener('click', function() {
            const raw = sitesTextarea.value;
            const sites = validateAndParseSites(raw);
            if (!sites.length) {
                alert("Please enter at least one site or identifier in the list.");
                return;
            }

            let cycles = parseInt(cyclesInput.value, 10);
            if (!cycles || cycles < 1) cycles = 1;

            let capPerCycle = parseInt(capPerCycleInput.value, 10);
            if (isNaN(capPerCycle) || capPerCycle < 1) capPerCycle = null;

            const useHash = useFullPathSelect.value === 'hash';

            // Run the push sequence (synchronous and fast). Close modal after start.
            const ok = pushHistoryEntriesForList(sites, cycles, capPerCycle, useHash);
            if (ok) closeHistoryModal();
        });

        closeModalBtn.addEventListener('click', closeHistoryModal);

        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) closeHistoryModal();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (overlay.style.display === 'flex') closeHistoryModal();
            }
            // Shortcut: Ctrl + Alt + Shift + Z opens the popup
            if (e.ctrlKey && e.altKey && e.shiftKey && (e.key === 'Z' || e.key === 'z')) {
                e.preventDefault();
                if (overlay.style.display === 'flex') {
                    closeHistoryModal();
                } else {
                    openHistoryModal();
                }
            }
        });

        // Expose for quick access (optional)
        window.openHistoryModal = openHistoryModal;
        window.closeHistoryModal = closeHistoryModal;
    })();
</script>

<!-- Botpress Webchat Injected at the End (kept as in original) -->
<script src="https://cdn.botpress.cloud/webchat/v2.4/inject.js"></script>
<script src="https://files.bpcontent.cloud/2025/05/05/15/20250505153238-7V8LNUEO.js"></script>

</body>
</html>
